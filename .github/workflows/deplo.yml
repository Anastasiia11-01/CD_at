name: Deploy
run-name: ${{ github.actor }} is deploying

on:
  workflow_run:
    workflows: ["Run Tests"]
    types:
      - completed
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'     
        required: true
      
jobs:  
  deploy:
     runs-on: ubuntu-latest  
     steps:
         - name: Install SSH Key
           uses: shimataro/ssh-key-action@v2
           with:
             key: ${{ secrets.SSH_PRIVATE_KEY }}
             known_hosts: ${{ secrets.known_hosts}}
             
         - name: Adding Known Hosts
           run: ssh-keyscan -H ${{ secrets.SSH_HOST }}{% endraw%} >> ~/.ssh/known_hosts
              
         - name: Deploy app to droplet
           uses: appleboy/ssh-action@v0.1.4
           with:
            port: ${{ secrets.PORT }}
            host: ${{ secrets.SSH_HOST }}
            username: ${{ secrets.SSH_USER }}
            key: ${{ secrets.SSH_PRIVATE_KEY }}             
            script: ls
       
